/**
 * Monol Rulebook - Cursor Adapter
 *
 * .cursorrules ÌååÏùº ÎèôÍ∏∞Ìôî Ïñ¥ÎåëÌÑ∞
 */
import * as fs from 'fs/promises';
import * as path from 'path';
import { BasePlatformAdapter, registerAdapter, } from './platform-adapter.js';
// ============================================================================
// Cursor Adapter
// ============================================================================
export class CursorAdapter extends BasePlatformAdapter {
    name = 'cursor';
    outputFile = '.cursorrules';
    getOutputPath() {
        return path.join(this.basePath, this.outputFile);
    }
    async read() {
        try {
            return await fs.readFile(this.getOutputPath(), 'utf-8');
        }
        catch {
            return '';
        }
    }
    format(rules) {
        // CursorÏóêÏÑú ÌôúÏÑ±ÌôîÎêú Í∑úÏπôÎßå ÌïÑÌÑ∞ÎßÅ
        const cursorRules = rules.filter(r => r.enabled !== false &&
            (r.platforms?.cursor?.enabled !== false || !r.platforms));
        // Ìè¨Ìï® Ïó¨Î∂Ä ÌïÑÌÑ∞ÎßÅ
        const includeRules = cursorRules.filter(r => r.platforms?.cursor?.includeInRules !== false);
        const lines = [];
        // Ìó§Îçî
        lines.push('# Project Rules');
        lines.push('');
        lines.push('> Auto-generated by Monol Rulebook');
        lines.push(`> Last updated: ${new Date().toISOString()}`);
        lines.push('');
        // Í∑úÏπô ÏöîÏïΩ
        lines.push('## Overview');
        lines.push('');
        lines.push(`Total rules: ${includeRules.length}`);
        lines.push('');
        // Ïπ¥ÌÖåÍ≥†Î¶¨Î≥Ñ Í∑∏Î£πÌôî
        const byCategory = new Map();
        for (const rule of includeRules) {
            const category = rule.category.split('/')[0];
            if (!byCategory.has(category)) {
                byCategory.set(category, []);
            }
            byCategory.get(category).push(rule);
        }
        // Í∑úÏπô Ï∂úÎ†•
        for (const [category, catRules] of byCategory) {
            lines.push(`## ${this.capitalizeFirst(category)} Rules`);
            lines.push('');
            for (const rule of catRules) {
                lines.push(this.formatRule(rule));
                lines.push('');
            }
        }
        // Ìë∏ÌÑ∞
        lines.push('---');
        lines.push('');
        lines.push('For more details, run `/rule <id>` in Claude Code');
        return lines.join('\n');
    }
    async write(content) {
        await this.ensureDir(this.getOutputPath());
        await fs.writeFile(this.getOutputPath(), content, 'utf-8');
    }
    formatRule(rule) {
        const lines = [];
        // Í∑úÏπô Ìó§Îçî
        const severityEmoji = rule.severity === 'error' ? 'üî¥' :
            rule.severity === 'warning' ? 'üü°' : 'üîµ';
        lines.push(`### ${severityEmoji} ${rule.name}`);
        lines.push('');
        // ÏÑ§Î™Ö
        lines.push(rule.description.trim());
        lines.push('');
        // ÏòàÏãú
        if (rule.examples) {
            if (rule.examples.good && rule.examples.good.length > 0) {
                lines.push('**Do:**');
                lines.push('```');
                for (const example of rule.examples.good) {
                    lines.push(example.trim());
                }
                lines.push('```');
                lines.push('');
            }
            if (rule.examples.bad && rule.examples.bad.length > 0) {
                lines.push("**Don't:**");
                lines.push('```');
                for (const example of rule.examples.bad) {
                    lines.push(example.trim());
                }
                lines.push('```');
                lines.push('');
            }
        }
        // ÏòàÏô∏
        if (rule.exceptions && rule.exceptions.length > 0) {
            lines.push('**Exceptions:**');
            for (const exception of rule.exceptions) {
                lines.push(`- ${exception}`);
            }
            lines.push('');
        }
        return lines.join('\n');
    }
    capitalizeFirst(str) {
        return str.charAt(0).toUpperCase() + str.slice(1);
    }
}
// Ïñ¥ÎåëÌÑ∞ Îì±Î°ù
registerAdapter('cursor', CursorAdapter);
export default CursorAdapter;
//# sourceMappingURL=cursor-adapter.js.map